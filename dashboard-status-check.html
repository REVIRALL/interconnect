<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Dashboard Status Check</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .check-item { margin: 10px 0; padding: 15px; border: 1px solid #ddd; }
        .success { background: #d4edda; }
        .warning { background: #fff3cd; }
        .error { background: #f8d7da; }
        .dynamic { background: #cfe2ff; }
        pre { background: #f4f4f4; padding: 10px; overflow: auto; }
        .highlight { background: yellow; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Dashboard Dynamic Data Status Check</h1>
    
    <div id="results"></div>

    <script src="js/supabase-client.js"></script>
    <script>
        function addResult(title, status, details) {
            const div = document.createElement('div');
            div.className = `check-item ${status}`;
            div.innerHTML = `
                <h3>${title}</h3>
                ${details}
            `;
            document.getElementById('results').appendChild(div);
        }

        async function checkDashboard() {
            // 1. 統計カードの動的データ
            addResult('統計カードの動的要素', 'dynamic', `
                <ul>
                    <li>総メンバー数: <span class="highlight">前月比の成長率が計算される</span></li>
                    <li>今月のイベント: <span class="highlight">前月からの増減数が表示</span></li>
                    <li>マッチング成功数: <span class="highlight">成功率の増加が計算</span></li>
                    <li>未読メッセージ: <span class="highlight">減少/増加率が動的に変化</span></li>
                </ul>
            `);

            // 2. アクティビティの時間表示
            addResult('アクティビティの時間表示', 'success', `
                <ul>
                    <li>「たった今」 - 1分以内</li>
                    <li>「X分前」 - 1時間以内</li>
                    <li>「X時間前」 - 24時間以内</li>
                    <li>「X日前」 - 7日以内</li>
                    <li>それ以降は日付表示</li>
                </ul>
            `);

            // 3. イベントの日付表示
            addResult('イベントの日付処理', 'success', `
                <ul>
                    <li>日付は動的にフォーマット</li>
                    <li>月は「X月」形式で表示</li>
                    <li>将来の日付のみ表示（過去のイベントはフィルタリング）</li>
                </ul>
            `);

            // 4. リアルタイム更新
            addResult('リアルタイム更新機能', 'warning', `
                <ul>
                    <li>30秒間隔で自動更新</li>
                    <li>Supabaseのリアルタイム購読機能</li>
                    <li>ページ visibility API対応（バックグラウンドで更新停止）</li>
                </ul>
            `);

            // 5. 計算されるデータ
            addResult('動的に計算されるデータ', 'dynamic', `
                <ul>
                    <li><strong>メンバー成長率</strong>: (現在 - 前月) / 前月 × 100</li>
                    <li><strong>イベント増減</strong>: 現在のイベント数 - 前月のイベント数</li>
                    <li><strong>マッチング成功率</strong>: 成功数の前月比</li>
                    <li><strong>メッセージ減少率</strong>: 未読数の変化率（減少が良い）</li>
                </ul>
            `);

            // 実際のデータをチェック
            try {
                const { data, error } = await window.supabase
                    .from('dashboard_stats')
                    .select('*')
                    .limit(1);

                if (data && data.length > 0) {
                    addResult('実際のデータベース値', 'success', `
                        <pre>${JSON.stringify(data[0], null, 2)}</pre>
                    `);
                } else {
                    addResult('データベース接続', 'error', 'データが取得できません');
                }
            } catch (e) {
                addResult('エラー', 'error', e.message);
            }
        }

        // 実行
        window.addEventListener('supabaseReady', checkDashboard);
        setTimeout(checkDashboard, 1000);
    </script>
</body>
</html>