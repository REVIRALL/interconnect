# TimeRex設定手順書

## 1. TimeRexアカウント作成

### 1.1 アカウント登録
1. https://timerex.jp にアクセス
2. 「新規登録」をクリック
3. 以下の情報を入力：
   - メールアドレス
   - パスワード
   - 組織名：INTERCONNECT
   - 担当者名

### 1.2 初期設定
1. メール認証を完了
2. ログイン後、初期設定ウィザードに従う
3. タイムゾーン：`Asia/Tokyo (GMT+9)`を選択

## 2. 予約ページ作成

### 2.1 新規予約ページ作成
1. ダッシュボード → 「予約ページ」→「新規作成」
2. 以下の情報を設定：

```
ページタイプ: 1対1の予約
ページ名: INTERCONNECT 無料相談予約
URL: interconnect-consultation
説明: ビジネスに関する無料相談を承ります。起業、資金調達、マーケティング、組織づくりなど、お気軽にご相談ください。
```

### 2.2 基本設定

#### 予約時間設定
```
予約時間単位: 30分
バッファ時間（前）: 5分
バッファ時間（後）: 10分
最大事前予約期間: 30日
最小事前予約期間: 24時間
```

#### 営業時間設定
```
月曜日: 09:00 - 18:00
火曜日: 09:00 - 18:00
水曜日: 09:00 - 18:00
木曜日: 09:00 - 18:00
金曜日: 09:00 - 18:00
土曜日: 休業
日曜日: 休業

※祝日は自動的に休業日に設定
```

### 2.3 カスタムフィールド設定（重要！）

予約フォームに以下のカスタムフィールドを追加：

#### フィールド1: 紹介コード
```
フィールドタイプ: テキスト
フィールドID: referral_code
フィールド名: 紹介コード
表示設定: 非表示
必須: はい
デフォルト値: DIRECT
説明: システムが自動入力します
```

#### フィールド2: ユーザーID
```
フィールドタイプ: テキスト
フィールドID: user_id
フィールド名: ユーザーID
表示設定: 非表示
必須: いいえ
デフォルト値: （空）
説明: システムが自動入力します
```

#### フィールド3: 相談内容
```
フィールドタイプ: 選択式（ドロップダウン）
フィールドID: consultation_type
フィールド名: ご相談内容
表示設定: 表示
必須: はい
選択肢:
- 起業・創業相談
- 資金調達相談
- マーケティング相談
- 人材・組織相談
- 業務改善・DX相談
- その他
```

#### フィールド4: 詳細
```
フィールドタイプ: テキストエリア
フィールドID: consultation_details
フィールド名: ご相談内容の詳細（任意）
表示設定: 表示
必須: いいえ
最大文字数: 500
プレースホルダー: 具体的なご相談内容をお書きください（任意）
```

### 2.4 通知設定

#### 予約確認メール
1. 「通知」タブ → 「予約確認メール」
2. テンプレートを編集：

```
件名: 【INTERCONNECT】ご予約確認

本文:
{{customer_name}} 様

この度はINTERCONNECTの無料相談をご予約いただき、誠にありがとうございます。

■ ご予約内容
日時：{{date}} {{time}}
担当：{{staff_name}}
相談内容：{{custom_consultation_type}}
会議形式：オンライン（Google Meet）

■ 参加方法
ご予約時間になりましたら、以下のURLからご参加ください。
{{meeting_url}}

■ ご準備いただくもの
- 相談したい内容の概要
- 関連する資料（あれば）
- 安定したインターネット環境

ご不明な点がございましたら、お気軽にお問い合わせください。
当日お会いできることを楽しみにしております。

INTERCONNECT
```

#### リマインダーメール
1. 「通知」タブ → 「リマインダーメール」
2. 送信タイミング：予約24時間前
3. 上記と同様のテンプレートを設定

### 2.5 オンライン会議設定

1. 「統合」タブ → 「Google Meet」
2. 「Google Meetを有効にする」をON
3. Googleアカウントと連携
4. 「自動的に会議URLを生成」をON

## 3. API設定

### 3.1 APIキーの取得
1. 「設定」→「API」
2. 「APIキーを生成」をクリック
3. 生成されたAPIキーをコピー（後で使用）

### 3.2 Webhook設定

1. 「設定」→「API」→「Webhook」タブ
2. 「新規Webhook」をクリック
3. 以下を設定：

```
Webhook URL: https://interconnect-auto.netlify.app/api/timerex-webhook
シークレットキー: [強力なランダム文字列を生成して入力]
```

**シークレットキー生成例（ターミナルで実行）:**
```bash
openssl rand -base64 32
```

4. イベント選択：
   - ✅ 予約作成時 (booking.created)
   - ✅ 予約確定時 (booking.confirmed)
   - ✅ 予約完了時 (booking.completed)
   - ✅ 予約キャンセル時 (booking.cancelled)
   - ✅ 予約変更時 (booking.updated)

5. 「保存」をクリック

### 3.3 Webhookテスト
1. 「テスト送信」ボタンをクリック
2. レスポンスが200 OKであることを確認

## 4. 予約ページのカスタマイズ

### 4.1 デザイン設定
1. 「予約ページ」→ 作成したページを選択
2. 「デザイン」タブ
3. 以下を設定：

```
プライマリカラー: #3b82f6 (青)
セカンダリカラー: #2563eb (濃い青)
背景色: #ffffff
テキスト色: #1f2937
```

### 4.2 ヘッダー/フッター
1. ロゴアップロード（あれば）
2. カスタムCSS（必要に応じて）：

```css
/* INTERCONNECTブランドカラー */
.booking-header {
  background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
}

.booking-button {
  background-color: #3b82f6;
  transition: all 0.3s ease;
}

.booking-button:hover {
  background-color: #2563eb;
  transform: translateY(-2px);
}
```

## 5. 埋め込み設定

### 5.1 iframe埋め込みコード取得
1. 「予約ページ」→「埋め込み」
2. 「iframe」タブ
3. 以下のオプションを設定：
   - 幅: 100%
   - 高さ: 600px
   - ボーダー: なし

### 5.2 生成されたコード
```html
<iframe 
  src="https://timerex.jp/book/interconnect-consultation"
  width="100%"
  height="600"
  frameborder="0"
  scrolling="no">
</iframe>
```

## 6. 動作確認

### 6.1 予約ページ確認
1. https://timerex.jp/book/interconnect-consultation にアクセス
2. 予約フォームが正しく表示されることを確認
3. カスタムフィールドが設定通りであることを確認

### 6.2 テスト予約
1. テスト予約を作成
2. 確認メールが届くことを確認
3. Webhookが正しく送信されることを確認（Supabaseのログで確認）

## 7. 本番設定前のチェックリスト

- [ ] APIキーを安全に保管した
- [ ] Webhookシークレットキーを保管した
- [ ] カスタムフィールドIDが正確に設定されている
- [ ] 営業時間が正しく設定されている
- [ ] 通知メールのテンプレートが適切
- [ ] Google Meet連携が有効
- [ ] Webhookのテスト送信が成功
- [ ] 予約ページのデザインが適切

## 重要な値のまとめ

保管が必要な情報：
- TimeRex APIキー: `7nxFkWUcjmbEXpXAoeP5TujgbH7Zrk7p8nbAmMYcAfoCdM6RgnI2qK6lSEpZaGAp`
- 予約ページID: `interconnect-consultation`
- Webhookシークレットキー: [生成した値]

これらの値は、Supabase Edge Functionsの環境変数に設定します。