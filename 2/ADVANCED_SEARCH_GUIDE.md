# 高度な検索機能 実装ガイド

## 概要
INTERCONNECTプラットフォームの高度な検索機能を実装しました。この機能により、ユーザーは複数の条件を組み合わせて、メンバーを効率的に検索できます。

## 実装内容

### 1. 新規作成ファイル

#### JavaScript
- `/js/advanced-search.js`
  - 複数条件での絞り込み検索
  - リアルタイム検索結果更新
  - 検索履歴の保存
  - 検索条件の保存・読み込み

#### CSS
- `/css/advanced-search.css`
  - 検索UIのスタイリング
  - フィルタータグのデザイン
  - レスポンシブ対応

#### SQL
- `/sql/create-search-history-table.sql`
  - 検索履歴テーブルの作成
  - 人気検索キーワードの集計ビュー

### 2. 更新ファイル
- `/members.html`
  - 高度な検索コンテナを追加
  - CSSとJavaScriptを読み込み

## 主な機能

### 1. キーワード検索
- 名前、会社名、自己紹介文での検索
- リアルタイム検索（500msのデバウンス付き）
- Enterキーでの検索実行

### 2. フィルター機能
- **業界**: IT・テクノロジー、金融、製造業など
- **スキル**: AI・機械学習、ブロックチェーン、IoTなど
- **興味・関心**: 新規事業開発、DX推進、グローバル展開など
- **ビジネス課題**: 売上向上、新規顧客獲得、コスト削減など
- **地域**: 東京、大阪、名古屋、福岡など

### 3. その他の条件
- プロフィール画像の有無
- 最終ログイン日時（1日以内、1週間以内、1ヶ月以内など）

### 4. ソート機能
- 関連性順
- 新着順
- アクティブ順（最終ログイン順）

### 5. 検索履歴
- 検索クエリと条件の自動保存
- 90日以上前の履歴は自動削除
- 人気検索キーワードの集計

## 使用方法

### ユーザー側の操作
1. メンバーページにアクセス
2. 検索バーにキーワードを入力
3. 「フィルター」ボタンをクリックして詳細条件を設定
4. 条件を選択して「適用」をクリック

### 開発者向け API

```javascript
// 検索実行
window.AdvancedSearch.search()

// フィルターの表示切り替え
window.AdvancedSearch.toggleFilters()

// フィルターの適用
window.AdvancedSearch.applyFilters()

// フィルターのリセット
window.AdvancedSearch.resetFilters()

// ソート変更
window.AdvancedSearch.changeSort('newest')

// コネクト申請送信
window.AdvancedSearch.sendConnect(userId)
```

## データベース設計

### search_history テーブル
```sql
- id: UUID (主キー)
- user_id: UUID (ユーザーID)
- search_query: TEXT (検索クエリ)
- filters: JSONB (フィルター条件)
- searched_at: TIMESTAMP (検索日時)
- results_count: INTEGER (結果件数)
- clicked_results: UUID[] (クリックされた結果)
```

### popular_search_keywords ビュー
- 過去30日間の人気検索キーワードを集計
- 検索回数とユニークユーザー数を表示

## パフォーマンス最適化

### 1. デバウンス処理
- キーワード入力時に500msの遅延を設定
- 不要なAPI呼び出しを削減

### 2. クライアントサイドフィルタリング
- 配列型のデータ（スキル、興味など）はクライアント側で処理
- サーバー負荷を軽減

### 3. ページネーション
- 1ページあたり20件の結果を表示
- 大量データの効率的な処理

## セキュリティ

### RLSポリシー
- ユーザーは自分の検索履歴のみ閲覧・作成可能
- 他のユーザーの検索履歴にはアクセス不可

### 入力値の検証
- SQLインジェクション対策
- XSS対策（HTML エスケープ）

## トラブルシューティング

### よくある問題

1. **検索結果が表示されない**
   - Supabaseの接続を確認
   - RLSポリシーが正しく設定されているか確認
   - ブラウザコンソールでエラーを確認

2. **フィルターが機能しない**
   - localStorage の容量を確認
   - フィルター条件が正しく保存されているか確認

3. **検索が遅い**
   - インデックスが作成されているか確認
   - ネットワーク速度を確認

## 今後の改善案

1. **全文検索の実装**
   - PostgreSQLの全文検索機能を活用
   - より高度な検索アルゴリズム

2. **AI検索**
   - 自然言語処理による検索
   - 類似ユーザーの推薦

3. **検索結果の最適化**
   - 検索履歴に基づくパーソナライズ
   - 機械学習による関連性スコアリング

4. **追加フィルター**
   - 年齢層
   - 経験年数
   - プロジェクト規模